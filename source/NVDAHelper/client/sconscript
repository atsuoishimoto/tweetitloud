Import([
	'env',
])

winIPCUtilsObj=env.Object("./winIPCUtils","#common/winIPCUtils.cpp")

controllerRPCHeader,controllerRPCClientSource=env.MSRPCStubs(
	target="./nvdaController",
	source=[
		"#interfaces/nvdaController/nvdaController.idl",
		"#interfaces/nvdaController/nvdaController.acf",
	],
	MSRPCStubs_noServer=True,
	MSRPCStubs_prefix="nvdaController_",
)

clientLibName="nvdaControllerClient%s"%('64' if env['TARGET_ARCH']=='x86_64' else '32')

clientLib=env.SharedLibrary(
	target=clientLibName,
	source=[
		"client.c",
		winIPCUtilsObj,
		controllerRPCClientSource,
		'nvdaControllerClient.def',
	],
	LIBS=[
		"user32",
		"rpcrt4",
	],
)

#if 'install' in COMMAND_LINE_TARGETS:
#	installDir=env.Install('#../../extras/controllerClient/',clientLib)
#	env.Default(installDir)

#env.Default(clientLib)

Return(['clientLib','controllerRPCHeader'])
